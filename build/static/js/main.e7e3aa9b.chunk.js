(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{233:function(e,t,n){e.exports=n(543)},251:function(e,t){},253:function(e,t){},264:function(e,t,n){},285:function(e,t){},332:function(e,t){},333:function(e,t){},394:function(e,t){},543:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n(134),r=n(5),s=n(8),o=n(19),c=n(18),u=n(20),l=n(1),h=n(89),d=n(24),m=n.n(d),p=n(46),y=n(37),f=n(228);n(264);function v(){return(v=Object(y.a)(m.a.mark(function e(t){var n,i;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("running search"),n=new f.RestClient("rest-samples","https://dev.virtualearth.net"),e.next=4,n.get("/REST/v1/Locations?q=".concat(t,"&key=ArLJodQ7fEaQ2dfy3lIHWJrJILC35_Qj0EpT8TCy3ls96pl6sqCdlu18bo8j_tbM"));case 4:return i=e.sent,e.abrupt("return",i.result.resourceSets[0].resources[0]);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}var g=function e(t,n,i,a,s){Object(r.a)(this,e),this.SearchResult=t,this.Riders=n,this.Coords=i,this.StartTime=a,this.EndTime=s},S=function(e){function t(e){var n;Object(r.a)(this,t),(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).inputElement=void 0,n.handleKeyDown=function(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),n.inputElement.blur()),""===n.state.SearchQuery&&n.setState({SearchResultVisible:!1})},n.handleSearchChanged=n.handleSearchChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleSearchBlur=n.handleSearchBlur.bind(Object(l.a)(Object(l.a)(n))),n.handleKeyDown=n.handleKeyDown.bind(Object(l.a)(Object(l.a)(n)));var i=n.getStateFromprops();return n.state=Object(p.a)({SearchResultVisible:!1},i),n.inputElement=null,n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"getStateFromprops",value:function(){return{SearchQuery:this.props.SearchResult&&this.props.SearchResult.SearchQuery?this.props.SearchResult.SearchQuery:"",SearchResult:this.props.SearchResult&&this.props.SearchResult.SearchResult?this.props.SearchResult.SearchResult:"",Coords:this.props.SearchResult&&this.props.SearchResult.Coords?this.props.SearchResult.Coords:{Lat:0,Long:0}}}},{key:"raiseSearchResultsChanged",value:function(){this.props.searchResultsChanged({SearchResult:this.state.SearchResult,Coords:this.state.Coords,SearchQuery:this.state.SearchQuery})}},{key:"componentDidUpdate",value:function(e,t){var n=this;t.SearchQuery==this.state.SearchQuery?e.SearchResult&&this.props.SearchResult&&e.SearchResult.SearchQuery!=this.props.SearchResult.SearchQuery&&this.setState(this.getStateFromprops(),function(){return n.resetCoordsFromBing(n.props.SearchResult.SearchQuery)}):this.raiseSearchResultsChanged()}},{key:"componentDidMount",value:function(){this.inputElement.focus()}},{key:"handleSearchChanged",value:function(e){this.setState({LastQuery:this.state.SearchQuery}),console.log("handlesearch changed last query is ".concat(this.state.LastQuery)),this.setState({SearchQuery:e.target.value,SearchResultVisible:!0}),this.resetCoordsFromBing(e.target.value)}},{key:"resetCoordsFromBing",value:function(e){var t=this;(function(e){return v.apply(this,arguments)})(e).then(function(e){console.log("last query is ".concat(t.state.LastQuery)),console.log("maps Response: ".concat(JSON.stringify(e))),void 0!==e&&t.setState({SearchResult:e.name,Coords:{Lat:e.point.coordinates[0],Long:e.point.coordinates[1]}},t.raiseSearchResultsChanged)})}},{key:"noticedChange",value:function(){return console.log("last query is ".concat(this.state.LastQuery)),console.log("search query is ".concat(this.state.SearchQuery)),console.log("search result is ".concat(this.state.SearchResult)),this.state.LastQuery!==this.state.SearchQuery?(this.setState({LastQuery:this.state.SearchQuery}),console.log("noticed change to ".concat(this.state.LastQuery)),!0):(console.log("noticed no change"),!1)}},{key:"handleSearchBlur",value:function(e){if(this.noticedChange()){var t=""===this.state.SearchQuery?"":this.state.SearchResult;this.setState({SearchQuery:t,SearchResultVisible:!1}),this.setState({LastQuery:t}),""!==t&&(this.setState({Submitted:!0}),this.raiseSearchResultsChanged())}}},{key:"render",value:function(){var e=this,t=i.createElement("div",{hidden:!0});return this.state.SearchResultVisible&&(t=i.createElement("div",null,i.createElement("input",{type:"text",value:this.state.SearchResult,readOnly:!0}),i.createElement("br",null))),i.createElement("span",null,i.createElement("input",{disabled:this.props.Disabled,type:"text",value:this.state.SearchQuery,onChange:this.handleSearchChanged,onBlur:this.handleSearchBlur,onKeyDown:this.handleKeyDown,ref:function(t){return e.inputElement=t}}),t)}}]),t}(i.Component),b=function(e){function t(e){var n;Object(r.a)(this,t),(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).handleRidersChanged=n.handleRidersChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleAddLocationClicked=n.handleAddLocationClicked.bind(Object(l.a)(Object(l.a)(n))),n.handleSearchResultChanged=n.handleSearchResultChanged.bind(Object(l.a)(Object(l.a)(n)));var i=!1;return(e.NumRiders||e.SearchResult)&&(i=!0),n.state={NumRiders:e.NumRiders,SearchQuery:e.SearchResult,SearchResult:e.SearchResult,SubmitEnabled:!1,Coords:e.Coords,Preloaded:i,Submitted:!1},n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"handleRidersChanged",value:function(e){var t=this;this.setState({NumRiders:parseInt(e.target.value)},function(){t.notifyLocationRiderChanged(),t.resetSubmitEnabled()})}},{key:"handleSearchResultChanged",value:function(e){console.log("handleSearchResultsChanged "),this.setState({SearchResult:e.SearchResult,Coords:e.Coords},this.resetSubmitEnabled),this.notifyLocationRiderChanged()}},{key:"notifyLocationRiderChanged",value:function(){(this.state.Submitted||this.state.Preloaded)&&this.props.handleLocationRiderChanged&&this.props.handleLocationRiderChanged({SearchResult:this.state.SearchResult,SearchQuery:this.state.SearchQuery,NumRiders:this.state.NumRiders,Coords:this.state.Coords})}},{key:"handleAddLocationClicked",value:function(){this.notifySubmitLocationRider(),this.setState({Submitted:!0})}},{key:"notifySubmitLocationRider",value:function(){this.props.submitLocationRider(this.state)}},{key:"resetSubmitEnabled",value:function(){this.state.NumRiders&&this.state.SearchResult&&this.setState({SubmitEnabled:!0})}},{key:"render",value:function(){return i.createElement("table",null,i.createElement("td",null),i.createElement("td",null),i.createElement("tr",null,i.createElement(S,{SearchResult:{SearchQuery:this.state.SearchQuery,SearchResult:this.state.SearchResult,Coords:this.state.Coords},searchResultsChanged:this.handleSearchResultChanged,Disabled:0===this.state.NumRiders}),i.createElement("div",{style:{display:"inline-block"}},i.createElement("label",{className:"RidersLabel"},"# Riders"),i.createElement("input",{className:"Riders",value:this.state.NumRiders,onChange:this.handleRidersChanged}),i.createElement("button",{className:"AddLocation",onClick:this.handleAddLocationClicked,disabled:!this.state.SubmitEnabled,style:{visibility:this.state.Submitted||this.state.Preloaded?"hidden":"visible"}},"Add location"))))}}]),t}(i.Component),R=n(229),C=n.n(R),T=n(9),O=n.n(T),j=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).state={LocationRiders:new Array,NumRiders:0},n.handleLocationRiderChanged=n.handleLocationRiderChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleSubmitRider=n.handleSubmitRider.bind(Object(l.a)(Object(l.a)(n))),n.resetRidersFromProps(),n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"resetRidersFromProps",value:function(){this.props.LocationRiders&&this.setState({LocationRiders:this.props.LocationRiders})}},{key:"componentDidUpdate",value:function(e){C()(e.LocationRiders,this.props.LocationRiders)||this.resetRidersFromProps()}},{key:"handleLocationRiderChanged",value:function(e,t){var n=this.state.LocationRiders;n[t]=e,this.resetLocationRiders(n)}},{key:"handleSubmitRider",value:function(e){var t=this.state.LocationRiders;t.push(e),this.resetLocationRiders(t)}},{key:"resetLocationRiders",value:function(e){var t=this;this.setState({LocationRiders:e,NumRiders:O.a.from(e).sum(function(e){return e.NumRiders})},function(){return t.props.handleLocationRidersChanged(t.state.LocationRiders)})}},{key:"render",value:function(){var e=this,t=i.createElement(b,{key:this.props.CollectionKey+(0==this.state.LocationRiders.length?"-1".toString():this.state.LocationRiders.length.toString()),submitLocationRider:function(t){return e.handleSubmitRider(t)}}),n=(new Array,this.state.LocationRiders.map(function(t,n){return i.createElement(b,{key:e.props.CollectionKey+n.toString(),NumRiders:t.NumRiders,SearchResult:t.SearchResult,Coords:t.Coords,submitLocationRider:function(t){return e.handleSubmitRider(t)},handleLocationRiderChanged:function(t){return e.handleLocationRiderChanged(t,n)}})}));return n.push(t),i.createElement("div",null,"Total Riders:",this.state.NumRiders,i.createElement("ol",null,n))}}]),t}(i.Component),E=function e(t){Object(r.a)(this,e),this.hours=void 0,this.minutes=void 0,this.hours=Math.floor(t/60),this.minutes=Math.round(t%60+0)},k=function e(){Object(r.a)(this,e)};k.Arrival="Arrival",k.Bus="Bus;";var w=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).handleArrivalViewTypeChanged=n.handleArrivalViewTypeChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleBusViewTypeChanged=n.handleBusViewTypeChanged.bind(Object(l.a)(Object(l.a)(n))),n.state={ViewType:k.Arrival},n.renderByBus=n.renderByBus.bind(Object(l.a)(Object(l.a)(n))),n.renderByArrival=n.renderByArrival.bind(Object(l.a)(Object(l.a)(n))),n.handleViewTypeChanged=n.handleViewTypeChanged.bind(Object(l.a)(Object(l.a)(n))),n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"formatDate",value:function(e){return e?new Date(this.fixAMPM(e)).toLocaleDateString():""}},{key:"formatTime",value:function(e){return e?new Date(this.fixAMPM(e)).toLocaleTimeString():""}},{key:"fixAMPM",value:function(e){return e.includes("P")?e.replace("P"," ")+" PM":e.includes("A")?e.replace("A"," ")+" AM":e}},{key:"handleArrivalViewTypeChanged",value:function(e){this.setState({ViewType:k.Arrival})}},{key:"handleBusViewTypeChanged",value:function(e){this.setState({ViewType:k.Bus})}},{key:"renderByArrival",value:function(){var e=this;return T.from(this.props.condensedInstructions.condensedInstructions).orderBy(function(t){return new Date(e.fixAMPM(t.startTime)).valueOf()}).toArray().map(function(t){var n,a,r,s,o,c;return a=i.createElement("td",null,t.agent),r=i.createElement("td",null,t.location),s=i.createElement("td",null,e.formatDate(t.startTime),"\xa0",e.formatTime(t.startTime)),o=i.createElement("td",null,t.endTime?e.formatDate(t.endTime):"","\xa0",t.endTime?e.formatTime(t.endTime):""),n=i.createElement("td",null,t.passengers),c=i.createElement("td",null,t.miles.toFixed(2)),i.createElement("tr",null,a,r,s,o,n,c)})}},{key:"renderByBus",value:function(){var e=this;return T.from(this.props.condensedInstructions.condensedInstructions).orderBy(function(e){return e.agent}).thenBy(function(t){return new Date(e.fixAMPM(t.startTime)).valueOf()}).toArray().map(function(t){var n,a,r,s,o,c;return a=i.createElement("td",null,t.agent),r=i.createElement("td",null,t.location),s=i.createElement("td",null,e.formatDate(t.startTime),"\xa0",e.formatTime(t.startTime)),o=i.createElement("td",null,t.endTime?e.formatDate(t.endTime):"","\xa0",t.endTime?e.formatTime(t.endTime):""),n=i.createElement("td",null,t.passengers),c=i.createElement("td",null,t.miles.toFixed(2)),i.createElement("tr",null,a,r,s,o,n,c)})}},{key:"handleViewTypeChanged",value:function(e){this.setState({ViewType:e.target.value})}},{key:"render",value:function(){var e=this,t=new E(this.props.condensedInstructions.minRouteTime),n=new E(this.props.condensedInstructions.maxRouteTime),a="Min Dist:".concat(this.props.condensedInstructions.minDistance.toFixed(1)," mi Max Dist:").concat(this.props.condensedInstructions.maxDistance.toFixed(1)," mi Min Time:").concat(t.hours," hrs ").concat(t.minutes," min Max Time:").concat(n.hours," hrs ").concat(n.minutes," min"),r=(T.from(this.props.condensedInstructions.condensedInstructions).orderBy(function(t){return new Date(e.fixAMPM(t.startTime)).valueOf()}).toArray(),this.state.ViewType===k.Arrival?this.renderByArrival():this.renderByBus());return i.createElement("div",null,i.createElement("h3",null,a),i.createElement("div",null,i.createElement("h4",null,"View By"),i.createElement("select",{onChange:this.handleViewTypeChanged,value:this.state.ViewType},i.createElement("option",{value:"Arrival",selected:!0},"Arrival"),i.createElement("option",{value:"Bus"},"Bus"))),i.createElement("table",null,i.createElement("tr",null,i.createElement("th",null,"Agent"),i.createElement("th",null,"Location"),i.createElement("th",null,"Arrive"),i.createElement("th",null,"Leave"),i.createElement("th",null,"# Riders"),i.createElement("th",null,"Miles")),r))}}]),t}(i.Component),L=n(230),A=n.n(L),D=function(e){function t(e){var n;Object(r.a)(this,t);return(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).state=Object(p.a)({},{collapsed:!0},n.calculateState(),{startingPoint:""}),n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"calculateState",value:function(){return{totalHours:Math.floor(this.props.condensedInstructionSet.maxRouteTime/60),totalMinutes:this.props.condensedInstructionSet.maxRouteTime%60,totalDistance:this.props.condensedInstructionSet.totalMiles}}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){var e="";if(this.props.condensedInstructionSet.missedCities&&this.props.condensedInstructionSet.missedCities.length>0){e=" Cities Missed:[";var t=!0,n=!1,a=void 0;try{for(var r,s=this.props.condensedInstructionSet.missedCities[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var o=r.value;e+=o.city+" - Riders: ".concat(o.riders,", ")}}catch(u){n=!0,a=u}finally{try{t||null==s.return||s.return()}finally{if(n)throw a}}e=e.substr(0,e.length-2),e+="]"}var c="Total Time:".concat(this.state.totalHours," hrs ").concat(this.state.totalMinutes.toFixed()," min Total Distance:").concat(this.props.condensedInstructionSet.totalMiles.toFixed(1)," mi #Buses:").concat(this.props.condensedInstructionSet.numAgents," #Riders:").concat(this.props.condensedInstructionSet.numRiders," Min Dist:").concat(this.props.condensedInstructionSet.minDistance.toFixed(1)," mi Max Dist:").concat(this.props.condensedInstructionSet.maxDistance.toFixed(1)," mi ").concat(e);return i.createElement(A.a,{trigger:c},i.createElement(w,{condensedInstructions:this.props.condensedInstructionSet}))}}]),t}(i.Component),I=n(70),B=n(43),x=n.n(B),M=n(231),Q=n(494),N=function e(t,n,i,a,s,o,c){Object(r.a)(this,e),this.name=t,this.dwellTime=n,this.location=i,this.quantity=a,this.openingTime=s,this.closingTime=o,this.startingTime=c},P=function(){function e(t,n,i){Object(r.a)(this,e),this.condensedInstructions=t,this.endLocationName=n,this.missedCities=i,this.totalMiles=0,this.numAgents=void 0,this.maxRouteTime=void 0,this.minDistance=void 0,this.maxDistance=void 0,this.minRouteTime=void 0,this.numRiders=void 0,this.durationMinutes=void 0;var a=new Set,s=T.from(t);this.numRiders=s.sum(function(e){return e.passengers});var o=s.groupBy(function(e){return e.agent});t.length>0?(this.maxRouteTime=o.max(function(e){return new Q(new Date(e.last().startTime),new Date(e.first().startTime)).minutes()}),this.minRouteTime=o.min(function(e){return new Q(new Date(e.last().startTime),new Date(e.first().startTime)).minutes()}),this.minDistance=o.min(function(e){return e.sum(function(e){return e.miles})}),this.maxDistance=o.max(function(e){return e.sum(function(e){return e.miles})}),this.durationMinutes=this.calculateDuration()):this.maxRouteTime=this.minRouteTime=this.maxDistance=this.minDistance=this.durationMinutes=0;for(var c=0;c<t.length;c++)this.totalMiles+=t[c].miles,a.add(t[c].agent);this.numAgents=a.size,this.condensedInstructions=T.from(t).orderBy(function(e){return e.startTime}).toArray()}return Object(s.a)(e,[{key:"adjustTimeFormat",value:function(e){e.startTime=e.startTime.replace("P","T").replace("A","T")}},{key:"calcMinutes",value:function(){return new Q(new Date(this.condensedInstructions[this.condensedInstructions.length-1].startTime),new Date(this.condensedInstructions[0].startTime)).minutes()}},{key:"calculateDuration",value:function(){var e=this;return this.condensedInstructions.map(function(t){return e.adjustTimeFormat(t)}),this.calcMinutes()}}]),e}(),F=function(){function e(t,n){var i=this;Object(r.a)(this,e),this.endLocationName=n,this.agent=void 0,this.instructions=void 0,this.distance=void 0,this.durationMinutes=void 0,this.instructions=t.instructions,this.agent=t.agent,this.distance=this.calcdistance(),this.durationMinutes=this.calcMinutes(),this.instructions.map(function(e){return i.adjustTimeFormat(e)})}return Object(s.a)(e,[{key:"filterInstructions",value:function(e){return"LeaveFromStartPoint"==e[0].instructionType?T.from(e).skip(2).toArray():e}},{key:"calcdistance",value:function(){for(var e=0,t=0;t<this.instructions.length;t++)this.instructions[t].distance&&(e+=this.instructions[t].distance);return 621371e-9*e}},{key:"adjustTimeFormat",value:function(e){e.startTime=e.startTime.replace("P","T").replace("A","T")}},{key:"calcMinutes",value:function(){return new Q(new Date(this.instructions[this.instructions.length-1].startTime),new Date(this.instructions[2].startTime)).minutes()}},{key:"recalculateDuration",value:function(){var e=this;this.instructions.map(function(t){return e.adjustTimeFormat(t)}),this.durationMinutes=this.calcMinutes()}},{key:"multipleStopsAtStartingLocation",value:function(e){var t=this.instructions[e.index],n=this.instructions.length>e.index+2?this.instructions[e.index+2]:void 0;return!!(n&&"VisitLocation"==n.instructionType&&n.itineraryItem.name==t.itineraryItem.name&&e.aggregatedQuantities>=0)&&(e.aggregatedQuantities+=t.itineraryItem.quantity[0],!0)}},{key:"startingPoint",get:function(){return this.instructions[2].itineraryItem.name}},{key:"condensedInstructions",get:function(){var e=new Array,t=0,n=!0,i=1;"LeaveFromStartPoint"==this.instructions[0].instructionType&&this.instructions[0].distance&&(i=2);for(var a={index:0,aggregatedQuantities:0},r=i;r<this.instructions.length-1;r++){var s=this.instructions[r];if("VisitLocation"==s.instructionType){if(a.index=r,this.multipleStopsAtStartingLocation(a)){r++;continue}e.push({agent:this.agent.name,startTime:s.startTime,endTime:s.endTime,location:s.itineraryItem?s.itineraryItem.name:"",miles:t,passengers:s.itineraryItem.quantity[0]+a.aggregatedQuantities}),a.aggregatedQuantities=0}else{if(n){t=0,n=!1;continue}t+=621371e-9*s.distance}}NaN==t&&console.log("Mile count is nan for:"+JSON.stringify(this));var o=this.instructions[this.instructions.length-1];return e.push({agent:this.agent.name,startTime:o.startTime,location:this.endLocationName,miles:t,passengers:0}),e}}]),e}(),V=function(){function e(t,n){Object(r.a)(this,e),this.resourceSets=t,this.destinationName=n,this.instructionSets=void 0,this.condensedInstructionSet=void 0,this.citiesVisited=void 0,this.citiesMissed=void 0,this.instructionSets=T.from(this.resourceSets[0].resources[0].agentItineraries).where(function(e){return e.instructions.length>3}).toArray().map(function(e){return new F(e,n)});var i=T.from(this.instructionSets),a=i.selectMany(function(e){return e.condensedInstructions}).orderBy(function(e){return e.startTime}).toArray();this.citiesVisited=i.selectMany(function(e){return e.condensedInstructions}).selectMany(function(e){return e.location}).distinct().toArray(),this.citiesMissed=T.from(this.resourceSets[0].resources[0].unscheduledItems).select(function(e){return{city:e.name,riders:e.quantity[0]}}).toArray(),this.condensedInstructionSet=new P(a,n,this.citiesMissed)}return Object(s.a)(e,[{key:"add_minutes",value:function(e,t){return new Date(e.getTime()+6e4*t)}},{key:"readjustForArrival",value:function(e){var t=this;T.from(this.condensedInstructionSet.condensedInstructions).groupBy(function(e){return e.agent}).forEach(function(n){var i=n.last(),a=new Date(i.startTime);console.log("Readjusting for end time: "+a),console.log("dateDiff:"+Q);var r=new Q(e,a).minutes()-1;console.log("Got difference between '".concat(e,"' and '").concat(i.startTime,"' as ").concat(r)),n.forEach(function(e){console.log("Changing start time for instruction '".concat(e.startTime,"'")),console.log("Readjusting for instruction set:"+JSON.stringify(e));var n=new Date(e.startTime);console.log("Changing start time for instruction date:'".concat(n,"'"));var i=t.add_minutes(n,r);console.log("Added '".concat(r,"' minutes to ").concat(n,":").concat(i)),e.startTime=x()(i,"yyyy-mm-ddThh:MM:ss"),e.endTime&&(n=new Date(e.endTime),i=t.add_minutes(n,r),e.endTime=x()(i,"yyyy-mm-ddThh:MM:ss"),console.log("Set startTime to ".concat(e.startTime)))})}),this.condensedInstructionSet.condensedInstructions=T.from(this.condensedInstructionSet.condensedInstructions).orderBy(function(e){return e.startTime}).toArray()}}]),e}(),J=function e(t,n){Object(r.a)(this,e),this.agents=t,this.itineraryItems=n},q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Agm6W2UbGpxQdxwdk3hJWc_7x3YkDMPA6nwX-7sZyYWuP-A96R8Cnc5BccClWQIK";Object(r.a)(this,e),this.key=t,this.semaphore=new M.Semaphore(25)}return Object(s.a)(e,[{key:"getYesterday",value:function(){var e=new Date;return e.setDate(e.getDate()-1),e}},{key:"addHours",value:function(e,t){(e=new Date(e.getTime())).setTime(e.getTime()+60*t*60*1e3)}},{key:"getItinerary",value:function(){var e=Object(y.a)(m.a.mark(function e(t){var n,i,a,r,s,o,c,u,l,h,d,p;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=O.a.from(t.searchParams).where(function(e){return e.Riders>0}).toArray().map(function(e){return new N(e.SearchResult,"00:"+t.dwellTime+":00",{latitude:e.Coords.Lat,longitude:e.Coords.Long},[e.Riders])}),console.log("Searching for start time:"+t.startTime),i=void 0==t.startTime?x()(this.getYesterday(),"yyyy-mm-ddThh:MM:ss"):x()(t.startTime,"yyyy-mm-ddThh:MM:ss"),a=void 0==t.endTime?x()(this.addHours(this.getYesterday(),12),"yyyy-mm-ddThh:MM:ss"):x()(t.endTime,"yyyy-mm-ddThh:MM:ss"),i=i.replace("P","T").replace("A","T"),a=a.replace("P","T").replace("A","T"),r=new Array,s=t.numAgents,t.numAgents>10&&(s=10),o=0;o<s;o++)r.push({capacity:[t.busCapacities[o]],name:"Bus_"+(o+1),shifts:[{startTime:i,endTime:a,endLocation:{latitude:t.endLocation.Lat,longitude:t.endLocation.Long},startLocation:{latitude:t.startLocation.Lat,longitude:t.startLocation.Long}}]});return e.next=12,this.semaphore.acquire();case 12:return c=e.sent,e.next=15,I.post("https://dev.virtualearth.net/REST/V1/Routes/OptimizeItineraryAsync?key="+this.key,{resolveWithFullResponse:!1,json:new J(r,n)});case 15:if(u=e.sent,l=u,console.log(JSON.stringify(l)),h=l.resourceSets[0].resources[0].callbackUrl,d=l.resourceSets[0].resources[0].callbackInSeconds,!h){e.next=23;break}return p=new Promise(function(e,t){var n,i=function(){var t=Object(y.a)(m.a.mark(function t(){return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("invoking callback url"),t.next=3,I.get(h);case 3:u=t.sent,l=JSON.parse(u),h=l.resourceSets[0].resources[0].callbackUrl,console.log(JSON.stringify(l)),h?n=setTimeout(i,1e3*d):(clearTimeout(n),e(l));case 8:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}();n=setTimeout(i,1e3*d)}),e.abrupt("return",p.then(function(e){return new V(JSON.parse(u).resourceSets,t.endLocationName)}).finally(function(){return c()}));case 23:return c(),e.abrupt("return",new V(u.resourceSets,t.endLocationName));case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),_=function(){function e(t){Object(r.a)(this,e),this.itinerary=t}return Object(s.a)(e,[{key:"addExtraStops",value:function(e){var t=new Array,n=T.from(e.busCapacities).min(),i=!0,a=!1,r=void 0;try{for(var s,o=e.searchResults[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var c=s.value;if(c.Riders>n){var u=c.Riders,l=Math.floor(u/n),h=u%n;0==h&&l--,c.Riders=n;for(var d=Object(p.a)({},c),m=1;m<=l;m++)t.push(Object(p.a)({},d));0!=h&&(t[t.length-1].Riders=h)}}}catch(y){a=!0,r=y}finally{try{i||null==o.return||o.return()}finally{if(a)throw r}}t.forEach(function(t){return e.searchResults.push(t)})}},{key:"getItineraries",value:function(){var e=Object(y.a)(m.a.mark(function e(t){var n,i,a,r,s,o,c,u,l,h,d,p,y,f,v,g,S;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.addExtraStops(t),n=new Array,i=1;case 3:if(!(i<=t.busCapacities.length)){e.next=26;break}for(a=!0,r=!1,s=void 0,e.prev=7,o=T.from(t.searchResults).where(function(e){return e.Riders>0})[Symbol.iterator]();!(a=(c=o.next()).done);a=!0)u=c.value,new Date(2019,11,17,10,0),new Date(2019,11,18,22,0),l=this.itinerary.getItinerary({numAgents:i,endLocationName:t.endLocationName,startLocation:u.Coords,searchParams:t.searchResults,dwellTime:t.dwellTime,endLocation:t.endLocation,startTime:u.StartTime,endTime:u.EndTime,busCapacities:t.busCapacities}),n.push(l);e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),r=!0,s=e.t0;case 15:e.prev=15,e.prev=16,a||null==o.return||o.return();case 18:if(e.prev=18,!r){e.next=21;break}throw s;case 21:return e.finish(18);case 22:return e.finish(15);case 23:i++,e.next=3;break;case 26:return h=new Array,e.next=29,Promise.all(n.map(function(e){return e.then(function(e){return h.push(e)})}));case 29:for(d=new Set,p=new Array,y=0,f=h;y<f.length;y++)v=f[y],g=v.condensedInstructionSet.durationMinutes+"_"+v.condensedInstructionSet.totalMiles+"_"+v.condensedInstructionSet.condensedInstructions.length,d.has(g)||(p.push(v),d.add(g));return S={itineraries:T.from(p).where(function(e){return void 0!==e.instructionSets}).orderByDescending(function(e){return e.instructionSets.length}).thenBy(function(e){return e.instructionSets.length>0?T.from(e.instructionSets).max(function(e){return e.durationMinutes}):0}).select(function(e){return e}).toArray()},e.abrupt("return",S);case 34:case"end":return e.stop()}},e,this,[[7,11,15,23],[16,,18,22]])}));return function(t){return e.apply(this,arguments)}}()}]),e}(),H=n(232),K=n.n(H),U=n(29),W=function(e){function t(e){var n;Object(r.a)(this,t),n=Object(o.a)(this,Object(c.a)(t).call(this,e));var i=U.b(new Date,"day"),a=U.a(i,20,"hours"),s=U.a(a,-1,"day");return n.state={Arrivaltime:U.a(s,1,"minutes")},n.handleArrivalTimeChanged=n.handleArrivalTimeChanged.bind(Object(l.a)(Object(l.a)(n))),n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"handleArrivalTimeChanged",value:function(e){this.setState({Arrivaltime:e})}},{key:"render",value:function(){if(!this.props.ItinerariesResponse)return i.createElement("div",null);var e,t=this.props.ItinerariesResponse.itineraries.map(function(e){return i.createElement("li",null,i.createElement(D,{condensedInstructionSet:e.condensedInstructionSet}))});return e=i.createElement("ol",null,t),i.createElement("div",null,i.createElement("h1",null,"Itineraries:"),i.createElement("ol",null,e))}}]),t}(i.Component),z=n(90),Y=n(91),G=n.n(Y),$=n(136),X=function(e){function t(e){var n;Object(r.a)(this,t),(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).handleBusCapacityChanged=n.handleBusCapacityChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleAddBus=n.handleAddBus.bind(Object(l.a)(Object(l.a)(n))),n.handleDeleteBus=n.handleDeleteBus.bind(Object(l.a)(Object(l.a)(n)));var i={capacities:new Array};return i.capacities.push({capacity:50,key:$.Guid.create().toString(),index:0}),n.state=i,n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.props.handleBusCapacityChanged(this.state.capacities)}},{key:"handleBusCapacityChanged",value:function(e,t,n){var i=this,a=this.state;a=G()(a,{capacities:Object(z.a)({},t,{$set:{capacity:e,index:t,key:n}})}),this.setState(a,function(){return i.props.handleBusCapacityChanged(i.state.capacities)})}},{key:"handleAddBus",value:function(){var e=this,t=this.state;t=G()(t,{capacities:{$push:[{capacity:50,key:$.Guid.create.toString(),index:this.state.capacities.length}]}}),this.setState(t,function(){return e.props.handleBusCapacityChanged(e.state.capacities)})}},{key:"handleDeleteBus",value:function(){var e=this,t=this.state;t=G()(t,{capacities:{$splice:[[this.state.capacities.length-1]]}}),this.setState(t,function(){return e.props.handleBusCapacityChanged(e.state.capacities)})}},{key:"render",value:function(){var e=this,t=this.state.capacities.map(function(t){return i.createElement("div",null,"Bus# ",t.index+1,i.createElement(h,{value:t.capacity,key:t.key,onChange:function(n){return e.handleBusCapacityChanged(n,t.index,t.key)},max:100,min:1}))});return i.createElement("div",null,i.createElement("div",null,"Enter bus capacity:"),t,i.createElement("input",{type:"submit",value:"Add bus",onClick:this.handleAddBus,disabled:this.state.capacities.length>=this.props.maxBuses}),i.createElement("input",{type:"submit",value:"Delete bus",onClick:this.handleDeleteBus,disabled:1==this.state.capacities.length}))}}]),t}(i.Component);X.defaultProps={maxBuses:10};var Z=new(function(){function e(){Object(r.a)(this,e)}return Object(s.a)(e,[{key:"getTrips",value:function(){var e=Object(y.a)(m.a.mark(function e(t){var n;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.get("https://rally-booking-preprod.azurewebsites.net/api/v1/booking-get-trips/".concat(t));case 2:return n=e.sent,e.abrupt("return",JSON.parse(n));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),e}()),ee=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).handleEventIdChanged=n.handleEventIdChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleSubmit=n.handleSubmit.bind(Object(l.a)(Object(l.a)(n))),n.state={eventId:""},n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"handleEventIdChanged",value:function(e){this.setState({eventId:e.target.value})}},{key:"handleSubmit",value:function(){var e=this;Z.getTrips(this.state.eventId).then(function(t){return e.props.rallyTripReceived(t)})}},{key:"render",value:function(){return i.createElement("div",null,i.createElement("label",null,"Enter Rally Event Id:"),i.createElement("input",{value:this.state.eventId,onChange:this.handleEventIdChanged}),i.createElement("button",{onClick:this.handleSubmit},"Submit"))}}]),t}(i.Component);var te=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(c.a)(t).call(this,e))).itineraryCollection=void 0,n.itinerary=void 0,n.searchResultHashmap={},n.itinerary=new q,n.itineraryCollection=new _(n.itinerary),n.handleDestinationChanged=n.handleDestinationChanged.bind(Object(l.a)(Object(l.a)(n))),n.state={DwellTime:15,Arrivaltime:n.initializeArrivalTime(),Loading:!1,CanSubmit:!1,Destination:{SearchQuery:""},SearchCount:0},n.handleDwellTimeChanged=n.handleDwellTimeChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleMultipleItinerarySearch=n.handleMultipleItinerarySearch.bind(Object(l.a)(Object(l.a)(n))),n.handleSearchItineraries=n.handleSearchItineraries.bind(Object(l.a)(Object(l.a)(n))),n.handleReadjustForArrival=n.handleReadjustForArrival.bind(Object(l.a)(Object(l.a)(n))),n.handleArrivalTimeChanged=n.handleArrivalTimeChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleBusCapacitiesChanged=n.handleBusCapacitiesChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleRallyTripsRecieved=n.handleRallyTripsRecieved.bind(Object(l.a)(Object(l.a)(n))),n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"initializeArrivalTime",value:function(){var e=U.b(new Date,"day"),t=U.a(e,20,"hours"),n=U.a(t,-1,"day");return U.a(n,1,"minutes")}},{key:"handleRallyTripsRecieved",value:function(e){this.setState({Arrivaltime:new Date(e[0].Schedule.DestinationArrivalTime),Destination:{SearchQuery:e[0].Schedule.DestinationCity.CityStateAbbr,SearchResult:e[0].Schedule.DestinationCity.CityStateAbbr,Coords:{Lat:25.927490234375,Long:-80.2232437133789}},SearchCount:this.state.SearchCount+1,CanSubmit:O.a.from(e).any(function(e){return e.State.RidersBookedOnTrip>0}),RallyLocationRiders:O.a.from(e).select(function(e){return{SearchResult:e.Schedule.OriginDepartureLocation?e.Schedule.OriginDepartureLocation:e.Schedule.OriginCity.CityStateAbbr,NumRiders:e.State.RidersBookedOnTrip,Coords:{Lat:e.DerivedPickupLatLng.Lat,Long:e.DerivedPickupLatLng.Long}}}).toArray()})}},{key:"render",value:function(){var e=this;if(this.state&&this.state.ItinerariesResponse){var t=this.state.ItinerariesResponse.itineraries.map(function(e){return i.createElement("li",null,i.createElement(D,{condensedInstructionSet:e.condensedInstructionSet}))});i.createElement("ol",null,t)}return i.createElement("div",null,i.createElement(ee,{rallyTripReceived:this.handleRallyTripsRecieved}),i.createElement("div",null,"Enter destination:",i.createElement("div",null,i.createElement(S,{key:"Destination",SearchResult:this.state.Destination,searchResultsChanged:this.handleDestinationChanged}))),i.createElement("div",null,"Enter dwell time:",i.createElement("br",null),i.createElement(h,{value:this.state.DwellTime,max:120,onChange:this.handleDwellTimeChanged})),"Enter arrival time:",i.createElement("br",null),i.createElement(K.a,{value:this.state.Arrivaltime,onChange:this.handleArrivalTimeChanged}),i.createElement(X,{handleBusCapacityChanged:this.handleBusCapacitiesChanged}),i.createElement(j,{CollectionKey:"Landing_"+this.state.SearchCount+"_",handleLocationRidersChanged:function(t){return e.handleLocationRidersChanged(t)},LocationRiders:this.state.RallyLocationRiders}),i.createElement("button",{onClick:function(){return e.handleSearchItineraries()},disabled:!this.state.CanSubmit},"Search"),i.createElement("div",{style:{visibility:this.state.Loading?"visible":"hidden"}},"Loading..."),i.createElement(W,{ItinerariesResponse:this.state.ItinerariesResponse}))}},{key:"handleBusCapacitiesChanged",value:function(e){this.setState({BusCapacities:e})}},{key:"handleLocationRidersChanged",value:function(e){var t=O.a.from(e).select(function(e){return new g(e.SearchResult,e.NumRiders,e.Coords)}).toArray();this.setState({SearchResults:t}),this.state.Destination&&this.setState({CanSubmit:!0})}},{key:"handleArrivalTimeChanged",value:function(e){this.setState({Arrivaltime:e})}},{key:"handleReadjustForArrival",value:function(e){var t=this.searchResultHashmap,n=!1;this.state.SearchResults.forEach(function(i){var a=t[i.SearchResult];a&&(n=!0);var r=a,s=U.a(e,-r,"minutes");i.StartTime=s,i.EndTime=U.a(s,1,"day")}),n&&this.handleSearchItineraries(!0)}},{key:"handleReadjustForArrivalBySubtractDuration",value:function(e){var t=this;console.log("Readjusting for arrival date:"+e.toString());var n=this.state.ItinerariesResponse;n.itineraries.forEach(function(t){t.readjustForArrival(e)}),this.setState({ItinerariesResponse:void 0},function(){return t.setState({ItinerariesResponse:n})})}},{key:"handleMultipleItinerarySearch",value:function(e){this.setState({SearchResults:e})}},{key:"handleSearchItineraries",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.setState({Loading:!0}),this.itineraryCollection.getItineraries({dwellTime:this.state.DwellTime,searchResults:this.state.SearchResults,endLocation:this.state.Destination.Coords,endLocationName:this.state.Destination.SearchResult,busCapacities:O.a.from(this.state.BusCapacities).select(function(e){return e.capacity}).toArray()}).then(function(t){e.setState({ItinerariesResponse:t}),t.itineraries.forEach(function(t){t.instructionSets.forEach(function(t){e.searchResultHashmap[t.startingPoint]=t.durationMinutes})})}).then(function(){t||e.handleReadjustForArrivalBySubtractDuration(e.state.Arrivaltime)}).finally(function(){return e.setState({Loading:!1})})}},{key:"handleDestinationChanged",value:function(e){console.log("handle destination changed:"+JSON.stringify(e)),this.setState({Destination:e,SearchCount:this.state.SearchCount+1})}},{key:"handleDwellTimeChanged",value:function(e){this.setState({DwellTime:e.target.value})}}]),t}(i.Component);var ne=document.getElementById("root");Object(a.render)(i.createElement(function(){return i.createElement("div",{className:"App"},i.createElement("h1",null,"Hello CodeSandbox Test"),i.createElement("h2",null,"Enter locations"),i.createElement(te,null))},null),ne)}},[[233,2,1]]]);
//# sourceMappingURL=main.e7e3aa9b.chunk.js.map