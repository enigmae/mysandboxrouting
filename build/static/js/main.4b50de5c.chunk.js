(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{217:function(e,t,n){e.exports=n(506)},233:function(e,t){},235:function(e,t){},247:function(e,t,n){},295:function(e,t){},296:function(e,t){},357:function(e,t){},506:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n(128),s=n(7),r=n(10),c=n(21),o=n(20),u=n(22),l=n(1),h=n(45),d=n(24),m=n.n(d),f=n(44),y=n(213);n(247);function p(){return(p=Object(f.a)(m.a.mark(function e(t){var n,a;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("running search"),n=new y.RestClient("rest-samples","https://dev.virtualearth.net"),e.next=4,n.get("/REST/v1/Locations?q="+t+"&key=ArLJodQ7fEaQ2dfy3lIHWJrJILC35_Qj0EpT8TCy3ls96pl6sqCdlu18bo8j_tbM");case 4:return a=e.sent,e.abrupt("return",a.result.resourceSets[0].resources[0]);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}var v=function e(t,n,a,i,r){Object(s.a)(this,e),this.SearchResult=t,this.Riders=n,this.Coords=a,this.StartTime=i,this.EndTime=r},b=function(e){function t(e){var n;Object(s.a)(this,t),(n=Object(c.a)(this,Object(o.a)(t).call(this,e))).inputElement=void 0,n.handleKeyDown=function(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),n.inputElement.blur()),""===n.state.SearchQuery&&n.setState({SearchResultVisible:!1})},n.handleSearchChanged=n.handleSearchChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleSearchBlur=n.handleSearchBlur.bind(Object(l.a)(Object(l.a)(n))),n.handleKeyDown=n.handleKeyDown.bind(Object(l.a)(Object(l.a)(n)));var a="",i={Lat:0,Long:0};return e.SearchResult&&(e.SearchResult.SearchResult&&(a=e.SearchResult.SearchResult),e.SearchResult.Coords&&(i=e.SearchResult.Coords)),n.state={SearchResultVisible:!1,SearchQuery:e.SearchResult?e.SearchResult.SearchQuery:"",SearchResult:a,Coords:i},n.inputElement=null,n}return Object(u.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){this.inputElement.focus()}},{key:"handleSearchChanged",value:function(e){var t=this;this.setState({LastQuery:this.state.SearchQuery}),console.log("handlesearch changed last query is "+this.state.LastQuery),this.setState({SearchQuery:e.target.value,SearchResultVisible:!0}),function(e){return p.apply(this,arguments)}(e.target.value).then(function(e){console.log("last query is "+t.state.LastQuery),console.log("maps Response: "+JSON.stringify(e)),void 0!==e&&t.setState({SearchResult:e.name,Coords:{Lat:e.point.coordinates[0],Long:e.point.coordinates[1]}})})}},{key:"noticedChange",value:function(){return console.log("last query is "+this.state.LastQuery),console.log("search query is "+this.state.SearchQuery),console.log("search result is "+this.state.SearchResult),this.state.LastQuery!==this.state.SearchQuery?(this.setState({LastQuery:this.state.SearchQuery}),console.log("noticed change to "+this.state.LastQuery),!0):(console.log("noticed no change"),!1)}},{key:"handleSearchBlur",value:function(e){if(this.noticedChange()){var t=""===this.state.SearchQuery?"":this.state.SearchResult;this.setState({SearchQuery:t,SearchResultVisible:!1}),this.setState({LastQuery:t}),""!==t&&(this.setState({Submitted:!0}),this.props.searchResultsChanged({SearchResult:t,Coords:this.state.Coords,SearchQuery:this.state.SearchQuery}))}}},{key:"render",value:function(){var e,t=this;return this.state.SearchResultVisible&&(e=a.createElement("div",null,a.createElement("input",{type:"text",value:this.state.SearchResult,readOnly:!0}),a.createElement("br",null))),a.createElement("span",null,a.createElement("input",{type:"text",value:this.state.SearchQuery,onChange:this.handleSearchChanged,onBlur:this.handleSearchBlur,onKeyDown:this.handleKeyDown,ref:function(e){return t.inputElement=e}}),e)}}]),t}(a.Component),S=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(o.a)(t).call(this,e))).handleRidersChanged=n.handleRidersChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleAddLocationClicked=n.handleAddLocationClicked.bind(Object(l.a)(Object(l.a)(n))),n.handleSearchResultChanged=n.handleSearchResultChanged.bind(Object(l.a)(Object(l.a)(n))),n.state={NumRiders:e.NumRiders,SearchResult:e.SearchResult,SubmitEnabled:!1,Submitted:!1},n}return Object(u.a)(t,e),Object(r.a)(t,[{key:"handleRidersChanged",value:function(e){this.setState({NumRiders:e.target.value},this.resetSubmitEnabled)}},{key:"handleSearchResultChanged",value:function(e){console.log("handleSearchResultsChanged "),this.setState({SearchResult:e.SearchResult,Coords:e.Coords},this.resetSubmitEnabled),this.state.Submitted&&this.notifySubmitLocationRider()}},{key:"handleAddLocationClicked",value:function(){this.notifySubmitLocationRider(),this.setState({Submitted:!0})}},{key:"notifySubmitLocationRider",value:function(){this.props.submitLocationRider(this.state)}},{key:"resetSubmitEnabled",value:function(){this.state.NumRiders&&this.state.SearchResult&&this.setState({SubmitEnabled:!0})}},{key:"render",value:function(){return a.createElement("table",null,a.createElement("td",null),a.createElement("td",null),a.createElement("tr",null,a.createElement(b,{SearchResult:{SearchQuery:"",SearchResult:this.state.SearchResult},searchResultsChanged:this.handleSearchResultChanged}),a.createElement("div",{style:{display:"inline-block"}},a.createElement("label",{className:"RidersLabel"},"# Riders"),a.createElement("input",{className:"Riders",value:this.state.NumRiders,onChange:this.handleRidersChanged}),a.createElement("button",{className:"AddLocation",onClick:this.handleAddLocationClicked,disabled:!this.state.SubmitEnabled,style:{visibility:this.state.Submitted?"hidden":"visible"}},"Add location"))))}}]),t}(a.Component),g=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(o.a)(t).call(this,e))).state={LocationRiders:new Array},n.handleLocationRiderChanged=n.handleLocationRiderChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleSubmitRider=n.handleSubmitRider.bind(Object(l.a)(Object(l.a)(n))),n}return Object(u.a)(t,e),Object(r.a)(t,[{key:"handleLocationRiderChanged",value:function(e){}},{key:"handleSubmitRider",value:function(e){var t=this,n=this.state.LocationRiders;n.push(e),this.setState({LocationRiders:n},function(){return t.props.handleLocationRidersChanged(t.state.LocationRiders)})}},{key:"render",value:function(){var e=this,t=[a.createElement(S,{submitLocationRider:function(t){return e.handleSubmitRider(t)},handleLocationRiderChanged:this.handleLocationRiderChanged})],n=!0,i=!1,s=void 0;try{for(var r,c=this.state.LocationRiders[Symbol.iterator]();!(n=(r=c.next()).done);n=!0){var o=r.value;t.push(a.createElement(S,{NumRiders:o.NumRiders,SearchResult:o.SearchResult,submitLocationRider:function(t){return e.handleSubmitRider(t)}}))}}catch(u){i=!0,s=u}finally{try{n||null==c.return||c.return()}finally{if(i)throw s}}return a.createElement("ol",null,t)}}]),t}(a.Component),C=n(87),R=n(25),j=n.n(R),E=function e(t){Object(s.a)(this,e),this.hours=void 0,this.minutes=void 0,this.hours=Math.floor(t/60),this.minutes=Math.round(t%60+0)},O=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(r.a)(t,[{key:"formatDate",value:function(e){return e?new Date(this.fixPM(e)).toLocaleDateString():""}},{key:"formatTime",value:function(e){return e?new Date(this.fixPM(e)).toLocaleTimeString():""}},{key:"fixPM",value:function(e){return e.includes("P")?e.replace("P"," ")+" PM":e}},{key:"render",value:function(){var e=this,t=new E(this.props.condensedInstructions.minRouteTime),n=new E(this.props.condensedInstructions.maxRouteTime),i="Min Dist:".concat(this.props.condensedInstructions.minDistance.toFixed(1)," mi Max Dist:").concat(this.props.condensedInstructions.maxDistance.toFixed(1)," mi Min Time:").concat(t.hours," hrs ").concat(t.minutes," min Max Time:").concat(n.hours," hrs ").concat(n.minutes," min"),s=R.from(this.props.condensedInstructions.condensedInstructions).toArray().map(function(t){var n,i,s,r,c,o;return i=a.createElement("td",null,t.agent),s=a.createElement("td",null,t.location),r=a.createElement("td",null,e.formatDate(t.startTime),"\xa0",e.formatTime(t.startTime)),c=a.createElement("td",null,t.endTime?e.formatDate(t.endTime):"","\xa0",t.endTime?e.formatTime(t.endTime):""),n=a.createElement("td",null,t.passengers),o=a.createElement("td",null,t.miles.toFixed(2)),a.createElement("tr",null,i,s,r,c,n,o)});return a.createElement("div",null,a.createElement("h3",null,i),a.createElement("table",null,a.createElement("tr",null,a.createElement("th",null,"Agent"),a.createElement("th",null,"Location"),a.createElement("th",null,"Arrive"),a.createElement("th",null,"Leave"),a.createElement("th",null,"# Riders"),a.createElement("th",null,"Miles")),s))}}]),t}(a.Component),T=n(214),k=n.n(T),L=function(e){function t(e){var n;Object(s.a)(this,t);return(n=Object(c.a)(this,Object(o.a)(t).call(this,e))).state=Object(C.a)({},{collapsed:!0},n.calculateState(),{startingPoint:""}),n}return Object(u.a)(t,e),Object(r.a)(t,[{key:"calculateState",value:function(){return{totalHours:Math.floor(this.props.condensedInstructionSet.durationMinutes/60),totalMinutes:this.props.condensedInstructionSet.durationMinutes%60,totalDistance:this.props.condensedInstructionSet.totalMiles}}},{key:"componentDidUpdate",value:function(){var e=this.calculateState();this.state.totalDistance==e.totalDistance&&this.state.totalHours==e.totalHours&&this.state.totalMinutes==e.totalMinutes||this.setState(e)}},{key:"render",value:function(){var e="";if(this.props.condensedInstructionSet.missedCities&&this.props.condensedInstructionSet.missedCities.length>0){e=" Cities Missed:[";var t=!0,n=!1,i=void 0;try{for(var s,r=this.props.condensedInstructionSet.missedCities[Symbol.iterator]();!(t=(s=r.next()).done);t=!0){var c=s.value;e+=c.city+" - Riders: ".concat(c.riders,", ")}}catch(u){n=!0,i=u}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}e=e.substr(0,e.length-2),e+="]"}var o="Total Time:".concat(this.state.totalHours," hrs ").concat(this.state.totalMinutes.toFixed()," min Total Distance:").concat(this.props.condensedInstructionSet.totalMiles.toFixed(1)," mi #Buses:").concat(this.props.condensedInstructionSet.numAgents," Min Dist:").concat(this.props.condensedInstructionSet.minDistance.toFixed(1)," mi Max Dist:").concat(this.props.condensedInstructionSet.maxDistance.toFixed(1)," mi ").concat(e);return a.createElement(k.a,{trigger:o},a.createElement(O,{condensedInstructions:this.props.condensedInstructionSet}))}}]),t}(a.Component),w=n(129),M=n(52),I=n.n(M),x=n(215),A=n(457),D=function e(t,n,a,i,r,c,o){Object(s.a)(this,e),this.name=t,this.dwellTime=n,this.location=a,this.quantity=i,this.openingTime=r,this.closingTime=c,this.startingTime=o},B=function e(t,n,a,i,r,c,o,u){Object(s.a)(this,e),this.condensedInstructions=t,this.endLocationName=n,this.durationMinutes=a,this.minDistance=i,this.maxDistance=r,this.minRouteTime=c,this.maxRouteTime=o,this.missedCities=u,this.totalMiles=0,this.numAgents=void 0;for(var l=new Set,h=0;h<t.length;h++)this.totalMiles+=t[h].miles,l.add(t[h].agent);this.numAgents=l.size},Q=function(){function e(t,n){var a=this;Object(s.a)(this,e),this.endLocationName=n,this.agent=void 0,this.instructions=void 0,this.distance=void 0,this.durationMinutes=void 0,this.instructions=t.instructions,this.agent=t.agent,this.distance=this.calcdistance(),this.durationMinutes=this.calcMinutes(),this.instructions.map(function(e){return a.adjustTimeFormat(e)})}return Object(r.a)(e,[{key:"filterInstructions",value:function(e){return"LeaveFromStartPoint"==e[0].instructionType?R.from(e).skip(2).toArray():e}},{key:"calcdistance",value:function(){for(var e=0,t=0;t<this.instructions.length;t++)this.instructions[t].distance&&(e+=this.instructions[t].distance);return 621371e-9*e}},{key:"adjustTimeFormat",value:function(e){e.startTime=e.startTime.replace("P","T").replace("A","T")}},{key:"calcMinutes",value:function(){return new A(new Date(this.instructions[this.instructions.length-1].startTime),new Date(this.instructions[2].startTime)).minutes()}},{key:"recalculateDuration",value:function(){var e=this;this.instructions.map(function(t){return e.adjustTimeFormat(t)}),this.durationMinutes=this.calcMinutes()}},{key:"startingPoint",get:function(){return this.instructions[2].itineraryItem.name}},{key:"condensedInstructions",get:function(){var e=new Array,t=0,n=!0,a=1;"LeaveFromStartPoint"==this.instructions[0].instructionType&&this.instructions[0].distance&&(a=2);for(var i=a;i<this.instructions.length-1;i++){var s=this.instructions[i];if("VisitLocation"==s.instructionType)e.push({agent:this.agent.name,startTime:s.startTime,endTime:s.endTime,location:s.itineraryItem?s.itineraryItem.name:"",miles:t,passengers:s.itineraryItem.quantity[0]});else{if(n){t=0,n=!1;continue}t+=621371e-9*s.distance}}var r=this.instructions[this.instructions.length-1];return e.push({agent:this.agent.name,startTime:r.startTime,location:this.endLocationName,miles:t,passengers:0}),e}}]),e}(),N=function(){function e(t,n){Object(s.a)(this,e),this.resourceSets=t,this.destinationName=n,this.instructionSets=void 0,this.condensedInstructionSet=void 0,this.citiesVisited=void 0,this.citiesMissed=void 0,this.instructionSets=R.from(this.resourceSets[0].resources[0].agentItineraries).where(function(e){return e.instructions.length>3}).toArray().map(function(e){return new Q(e,n)});var a=R.from(this.instructionSets),i=a.selectMany(function(e){return e.condensedInstructions}).orderBy(function(e){return e.startTime}).toArray();this.citiesVisited=a.selectMany(function(e){return e.condensedInstructions}).selectMany(function(e){return e.location}).distinct().toArray(),this.citiesMissed=R.from(this.resourceSets[0].resources[0].unscheduledItems).select(function(e){return{city:e.name,riders:e.quantity[0]}}).toArray();var r=a.max(function(e){return e.durationMinutes});this.condensedInstructionSet=new B(i,n,r,a.min(function(e){return e.distance}),a.max(function(e){return e.distance}),r,a.max(function(e){return e.durationMinutes}),this.citiesMissed)}return Object(r.a)(e,[{key:"add_minutes",value:function(e,t){return new Date(e.getTime()+6e4*t)}},{key:"readjustForArrival",value:function(e){var t=this;R.from(this.condensedInstructionSet.condensedInstructions).groupBy(function(e){return e.agent}).forEach(function(n){var a=n.last(),i=new Date(a.startTime);console.log("Readjusting for end time: "+i),console.log("dateDiff:"+A);var s=new A(e,i).minutes()-1;console.log("Got difference between '".concat(e,"' and ").concat(a.startTime," as ").concat(s)),n.forEach(function(e){console.log("Changing start time for instruction '".concat(e.startTime,"'")),console.log("Readjusting for instruction set:"+JSON.stringify(e));var n=new Date(e.startTime);console.log("Changing start time for instruction date:'".concat(n,"'"));var a=t.add_minutes(n,s);console.log("Added '".concat(s,"' minutes to ").concat(n,":").concat(a)),e.startTime=I()(a,"yyyy-mm-ddThh:MM:ss"),e.endTime&&(n=new Date(e.endTime),a=t.add_minutes(n,s),e.endTime=I()(a,"yyyy-mm-ddThh:MM:ss"),console.log("Set startTime to ".concat(e.startTime)))})})}}]),e}(),F=function e(t,n){Object(s.a)(this,e),this.agents=t,this.itineraryItems=n},P=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ArLJodQ7fEaQ2dfy3lIHWJrJILC35_Qj0EpT8TCy3ls96pl6sqCdlu18bo8j_tbM";Object(s.a)(this,e),this.key=t,this.semaphore=new x.Semaphore(7)}return Object(r.a)(e,[{key:"getItinerary",value:function(){var e=Object(f.a)(m.a.mark(function e(t){var n,a,i,s,r,c,o,u,l,h,d,y;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.searchParams.map(function(e){return new D(e.SearchResult,"00:"+t.dwellTime+":00",{latitude:e.Coords.Lat,longitude:e.Coords.Long},[e.Riders])}),console.log("Searching for start time:"+t.startTime),a=void 0==t.startTime?"2019-11-16T08:00:00":I()(t.startTime,"yyyy-mm-ddThh:MM:ss"),i=void 0==t.endTime?"2019-11-16T18:00:00":I()(t.endTime,"yyyy-mm-ddThh:MM:ss"),a=a.replace("P","T").replace("A","T"),i=i.replace("P","T").replace("A","T"),s=new Array,r=t.numAgents,t.numAgents>3&&(r=3),c=0;c<r;c++)s.push({capacity:[t.busCapacity],name:"Bus_"+(c+1),shifts:[{startTime:a,endTime:i,endLocation:{latitude:t.endLocation.Lat,longitude:t.endLocation.Long},startLocation:{latitude:t.startLocation.Lat,longitude:t.startLocation.Long}}]});return e.next=12,this.semaphore.acquire();case 12:return o=e.sent,e.next=15,w.post("https://dev.virtualearth.net/REST/V1/Routes/OptimizeItineraryAsync?key="+this.key,{resolveWithFullResponse:!1,json:new F(s,n)});case 15:if(u=e.sent,l=u,console.log(JSON.stringify(l)),h=l.resourceSets[0].resources[0].callbackUrl,d=l.resourceSets[0].resources[0].callbackInSeconds,!h){e.next=23;break}return y=new Promise(function(e,t){var n,a=function(){var t=Object(f.a)(m.a.mark(function t(){return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("invoking callback url"),t.next=3,w.get(h);case 3:u=t.sent,l=JSON.parse(u),h=l.resourceSets[0].resources[0].callbackUrl,console.log(JSON.stringify(l)),h?n=setTimeout(a,1e3*d):(clearTimeout(n),e(l));case 8:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}();n=setTimeout(a,1e3*d)}),e.abrupt("return",y.then(function(e){return new N(JSON.parse(u).resourceSets,t.endLocationName)}).finally(function(){return o()}));case 23:return o(),e.abrupt("return",new N(u.resourceSets,t.endLocationName));case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),J=function(){function e(t){Object(s.a)(this,e),this.itinerary=t}return Object(r.a)(e,[{key:"addExtraStops",value:function(e){var t=new Array,n=!0,a=!1,i=void 0;try{for(var s,r=e.searchResults[Symbol.iterator]();!(n=(s=r.next()).done);n=!0){var c=s.value;if(c.Riders>e.busCapacity){var o=c.Riders,u=Math.floor(o/e.busCapacity),l=o%e.busCapacity;0==l&&u--,c.Riders=e.busCapacity;for(var h=Object(C.a)({},c),d=1;d<=u;d++)t.push(h);0!=l&&(t[t.length-1].Riders=l)}}}catch(m){a=!0,i=m}finally{try{n||null==r.return||r.return()}finally{if(a)throw i}}t.forEach(function(t){return e.searchResults.push(t)})}},{key:"getItineraries",value:function(){var e=Object(f.a)(m.a.mark(function e(t){var n,a,i,s,r,c,o,u,l,h,d,f,y,p,v,b,S;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.addExtraStops(t),n=new Array,a=t.minBuses;case 3:if(!(a<=t.maxBuses)){e.next=26;break}for(i=!0,s=!1,r=void 0,e.prev=7,c=t.searchResults[Symbol.iterator]();!(i=(o=c.next()).done);i=!0)u=o.value,new Date(2019,11,17,10,0),new Date(2019,11,18,22,0),l=this.itinerary.getItinerary({numAgents:a,endLocationName:t.endLocationName,startLocation:u.Coords,searchParams:t.searchResults,dwellTime:t.dwellTime,endLocation:t.endLocation,startTime:u.StartTime,endTime:u.EndTime,busCapacity:t.busCapacity}),n.push(l);e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),s=!0,r=e.t0;case 15:e.prev=15,e.prev=16,i||null==c.return||c.return();case 18:if(e.prev=18,!s){e.next=21;break}throw r;case 21:return e.finish(18);case 22:return e.finish(15);case 23:a++,e.next=3;break;case 26:return h=new Array,e.next=29,Promise.all(n.map(function(e){return e.then(function(e){return h.push(e)})}));case 29:for(d=new Set,f=new Array,y=0,p=h;y<p.length;y++)v=p[y],b=v.condensedInstructionSet.durationMinutes+"_"+v.condensedInstructionSet.totalMiles+"_"+v.condensedInstructionSet.condensedInstructions.length,d.has(b)||(f.push(v),d.add(b));return S={itineraries:R.from(f).where(function(e){return void 0!==e.instructionSets}).orderByDescending(function(e){return e.instructionSets.length}).thenBy(function(e){return R.from(e.instructionSets).max(function(e){return e.durationMinutes})}).select(function(e){return e}).toArray()},e.abrupt("return",S);case 34:case"end":return e.stop()}},e,this,[[7,11,15,23],[16,,18,22]])}));return function(t){return e.apply(this,arguments)}}()}]),e}(),q=n(216),H=n.n(q),_=n(29),V=function(e){function t(e){var n;Object(s.a)(this,t),n=Object(c.a)(this,Object(o.a)(t).call(this,e));var a=_.b(new Date,"day"),i=_.a(a,20,"hours"),r=_.a(i,-1,"day");return n.state={Arrivaltime:_.a(r,1,"minutes")},n.handleArrivalTimeChanged=n.handleArrivalTimeChanged.bind(Object(l.a)(Object(l.a)(n))),n}return Object(u.a)(t,e),Object(r.a)(t,[{key:"handleArrivalTimeChanged",value:function(e){this.setState({Arrivaltime:e})}},{key:"render",value:function(){if(!this.props.ItinerariesResponse)return a.createElement("div",null);var e,t=this.props.ItinerariesResponse.itineraries.map(function(e){return a.createElement("li",null," ",a.createElement(L,{condensedInstructionSet:e.condensedInstructionSet}))});return e=a.createElement("ol",null,t),a.createElement("div",null,a.createElement("h1",null,"Itineraries:"),a.createElement("ol",null,e))}}]),t}(a.Component),K=n(88),z=n(89),G=n.n(z),U=n(131),W=function(e){function t(e){var n;Object(s.a)(this,t),(n=Object(c.a)(this,Object(o.a)(t).call(this,e))).handleBusCapacityChanged=n.handleBusCapacityChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleAddBus=n.handleAddBus.bind(Object(l.a)(Object(l.a)(n)));var a={capacities:new Array};return a.capacities.push({capacity:50,key:U.Guid.create().toString(),index:0}),n.state=a,n}return Object(u.a)(t,e),Object(r.a)(t,[{key:"handleBusCapacityChanged",value:function(e,t){var n=this,a=this.state;a=G()(a,{capacities:Object(K.a)({},t.index,{$set:{capacity:e,index:t.index,key:t.key}})}),this.setState(a,function(){return n.props.handleBusCapacityChanged(n.state.capacities)})}},{key:"handleAddBus",value:function(){var e=this,t=this.state;G()([1,2,3],{$push:[4]});G()(t,{capacities:{$push:[{capacity:50,key:U.Guid.create.toString(),index:this.state.capacities.length}]}}),this.setState(t,function(){return e.props.handleBusCapacityChanged(e.state.capacities)})}},{key:"render",value:function(){var e=this,t=this.state.capacities.map(function(t){return a.createElement(h,{value:t.capacity,key:t.key,onChange:function(n){return e.handleBusCapacityChanged(n,t.index)},max:100,min:1})});return a.createElement("div",null,a.createElement("div",null,"Enter bus capacity:"),t,a.createElement("input",{type:"submit",value:"Add bus",onClick:this.handleAddBus}))}}]),t}(a.Component);var $=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(o.a)(t).call(this,e))).itineraryCollection=void 0,n.itinerary=void 0,n.searchResultHashmap={},n.itinerary=new P,n.itineraryCollection=new J(n.itinerary),n.handleDestinationChanged=n.handleDestinationChanged.bind(Object(l.a)(Object(l.a)(n))),n.state={DwellTime:15,Arrivaltime:n.initializeArrivalTime(),MinBuses:1,MaxBuses:3,BusCapacity:50,Loading:!1,CanSubmit:!1},n.handleDwellTimeChanged=n.handleDwellTimeChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleMultipleItinerarySearch=n.handleMultipleItinerarySearch.bind(Object(l.a)(Object(l.a)(n))),n.handleSearchItineraries=n.handleSearchItineraries.bind(Object(l.a)(Object(l.a)(n))),n.handleReadjustForArrival=n.handleReadjustForArrival.bind(Object(l.a)(Object(l.a)(n))),n.handleArrivalTimeChanged=n.handleArrivalTimeChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleMinBusesChanged=n.handleMinBusesChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleMaxBusesChanged=n.handleMaxBusesChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleBusCapacityChanged=n.handleBusCapacityChanged.bind(Object(l.a)(Object(l.a)(n))),n.handleBusCapacitiesChanged=n.handleBusCapacitiesChanged.bind(Object(l.a)(Object(l.a)(n))),n}return Object(u.a)(t,e),Object(r.a)(t,[{key:"initializeArrivalTime",value:function(){var e=_.b(new Date,"day"),t=_.a(e,20,"hours"),n=_.a(t,-1,"day");return _.a(n,1,"minutes")}},{key:"render",value:function(){var e=this;if(this.state&&this.state.ItinerariesResponse){var t=this.state.ItinerariesResponse.itineraries.map(function(e){return a.createElement("li",null,a.createElement(L,{condensedInstructionSet:e.condensedInstructionSet}))});a.createElement("ol",null,t)}return a.createElement("div",null,a.createElement("div",null,"Enter destination:",a.createElement("div",null,a.createElement(b,{SearchResult:{SearchQuery:"",SearchResult:void 0},searchResultsChanged:this.handleDestinationChanged}))),a.createElement("div",null,"Enter dwell time:",a.createElement("br",null),a.createElement(h,{value:this.state.DwellTime,max:120,onChange:this.handleDwellTimeChanged})),"Enter arrival time:",a.createElement("br",null),a.createElement(H.a,{value:this.state.Arrivaltime,onChange:this.handleArrivalTimeChanged}),a.createElement("div",null,"Enter min buses:"),a.createElement(h,{value:this.state.MinBuses,onChange:this.handleMinBusesChanged,min:1,max:3}),a.createElement("div",null,"Enter max buses:"),a.createElement(h,{min:1,max:3,value:this.state.MaxBuses,onChange:this.handleMaxBusesChanged}),a.createElement("div",null,"Enter bus capacity:"),a.createElement(h,{value:this.state.BusCapacity,onChange:this.handleBusCapacityChanged,max:100,min:1}),a.createElement(W,{handleBusCapacityChanged:this.handleBusCapacitiesChanged}),a.createElement(g,{handleLocationRidersChanged:function(t){return e.handleLocationRidersChanged(t)}}),a.createElement("button",{onClick:function(){return e.handleSearchItineraries()},disabled:!this.state.CanSubmit},"Search"),a.createElement("div",{style:{visibility:this.state.Loading?"visible":"hidden"}},"Loading..."),a.createElement(V,{ItinerariesResponse:this.state.ItinerariesResponse}))}},{key:"handleBusCapacitiesChanged",value:function(e){this.setState({BusCapacities:e})}},{key:"handleBusCapacityChanged",value:function(e){this.setState({BusCapacity:e})}},{key:"handleMinBusesChanged",value:function(e){this.setState({MinBuses:e})}},{key:"handleMaxBusesChanged",value:function(e){this.setState({MaxBuses:e})}},{key:"handleLocationRidersChanged",value:function(e){var t=j.a.from(e).select(function(e){return new v(e.SearchResult,e.NumRiders,e.Coords)}).toArray();this.setState({SearchResults:t}),this.state.Destination&&this.setState({CanSubmit:!0})}},{key:"handleArrivalTimeChanged",value:function(e){this.setState({Arrivaltime:e})}},{key:"handleReadjustForArrival",value:function(e){var t=this.searchResultHashmap,n=!1;this.state.SearchResults.forEach(function(a){var i=t[a.SearchResult];i&&(n=!0);var s=i,r=_.a(e,-s,"minutes");a.StartTime=r,a.EndTime=_.a(r,1,"day")}),n&&this.handleSearchItineraries(!0)}},{key:"handleReadjustForArrivalBySubtractDuration",value:function(e){var t=this;console.log("Readjusting for arrival date:"+e.toString());var n=this.state.ItinerariesResponse;n.itineraries.forEach(function(t){t.readjustForArrival(e)}),this.setState({ItinerariesResponse:void 0},function(){return t.setState({ItinerariesResponse:n})})}},{key:"handleMultipleItinerarySearch",value:function(e){this.setState({SearchResults:e})}},{key:"handleSearchItineraries",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.setState({Loading:!0}),this.itineraryCollection.getItineraries({dwellTime:this.state.DwellTime,searchResults:this.state.SearchResults,endLocation:this.state.Destination.Coords,endLocationName:this.state.Destination.SearchResult,minBuses:this.state.MinBuses,maxBuses:this.state.MaxBuses,busCapacity:this.state.BusCapacity}).then(function(t){e.setState({ItinerariesResponse:t}),t.itineraries.forEach(function(t){t.instructionSets.forEach(function(t){e.searchResultHashmap[t.startingPoint]=t.durationMinutes})})}).then(function(){t||e.handleReadjustForArrivalBySubtractDuration(e.state.Arrivaltime)}).finally(function(){return e.setState({Loading:!1})})}},{key:"handleDestinationChanged",value:function(e){console.log("handle destination changed:"+JSON.stringify(e)),this.setState({Destination:e})}},{key:"handleDwellTimeChanged",value:function(e){this.setState({DwellTime:e.target.value})}}]),t}(a.Component);var X=document.getElementById("root");Object(i.render)(a.createElement(function(){return a.createElement("div",{className:"App"},a.createElement("h1",null,"Hello CodeSandbox Test"),a.createElement("h2",null,"Enter locations"),a.createElement($,null))},null),X)}},[[217,2,1]]]);
//# sourceMappingURL=main.4b50de5c.chunk.js.map