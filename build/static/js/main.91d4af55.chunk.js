(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{213:function(e,t,n){e.exports=n(494)},227:function(e,t){},229:function(e,t){},241:function(e,t,n){},291:function(e,t){},292:function(e,t){},353:function(e,t){},494:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n(121),r=n(9),s=n(11),l=n(21),c=n(20),u=n(22),o=n(4),h=n(29),d=n.n(h),m=n(50),b=n(207);n(241);function S(){return(S=Object(m.a)(d.a.mark(function e(t){var n,a;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("running search"),n=new b.RestClient("rest-samples","https://dev.virtualearth.net"),e.next=4,n.get("/REST/v1/Locations?q="+t+"&key=ArLJodQ7fEaQ2dfy3lIHWJrJILC35_Qj0EpT8TCy3ls96pl6sqCdlu18bo8j_tbM");case 4:return a=e.sent,e.abrupt("return",a.result.resourceSets[0].resources[0]);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}var y=function e(t,n,a,i){Object(r.a)(this,e),this.SearchResult=t,this.Riders=n,this.StartTime=a,this.EndTime=i},p=function(e){function t(e){var n;Object(r.a)(this,t),(n=Object(l.a)(this,Object(c.a)(t).call(this,e))).inputElement=void 0,n.handleKeyDown=function(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),n.inputElement.blur()),""===n.state.SearchQuery&&n.setState({SearchResultVisible:!1})},n.handleSearchChanged=n.handleSearchChanged.bind(Object(o.a)(Object(o.a)(n))),n.handleSearchBlur=n.handleSearchBlur.bind(Object(o.a)(Object(o.a)(n))),n.handleKeyDown=n.handleKeyDown.bind(Object(o.a)(Object(o.a)(n)));var a="",i={Lat:0,Long:0};return e.SearchResult&&(e.SearchResult.SearchResult&&(a=e.SearchResult.SearchResult),e.SearchResult.Coords&&(i=e.SearchResult.Coords)),n.state={SearchResultVisible:!1,SearchQuery:e.SearchResult?e.SearchResult.SearchQuery:"",SearchResult:a,Coords:i},n.inputElement=null,n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.inputElement.focus()}},{key:"handleSearchChanged",value:function(e){var t=this;this.setState({LastQuery:this.state.SearchQuery}),console.log("handlesearch changed last query is "+this.state.LastQuery),this.setState({SearchQuery:e.target.value,SearchResultVisible:!0}),function(e){return S.apply(this,arguments)}(e.target.value).then(function(e){console.log("last query is "+t.state.LastQuery),console.log("maps Response: "+JSON.stringify(e)),void 0!==e&&t.setState({SearchResult:e.name,Coords:{Lat:e.point.coordinates[0],Long:e.point.coordinates[1]}})})}},{key:"noticedChange",value:function(){return console.log("last query is "+this.state.LastQuery),console.log("search query is "+this.state.SearchQuery),console.log("search result is "+this.state.SearchResult),this.state.LastQuery!==this.state.SearchQuery?(this.setState({LastQuery:this.state.SearchQuery}),console.log("noticed change to "+this.state.LastQuery),!0):(console.log("noticed no change"),!1)}},{key:"handleSearchBlur",value:function(e){if(this.noticedChange()){var t=""===this.state.SearchQuery?"":this.state.SearchResult;this.setState({SearchQuery:t,SearchResultVisible:!1}),this.setState({LastQuery:t}),""!==t&&(this.setState({Submitted:!0}),this.props.searchResultsChanged({SearchResult:t,Coords:this.state.Coords,SearchQuery:this.state.SearchQuery}))}}},{key:"render",value:function(){var e,t=this;return this.state.SearchResultVisible&&(e=a.createElement("div",null,a.createElement("input",{type:"text",value:this.state.SearchResult,readOnly:!0}),a.createElement("br",null))),a.createElement("span",null,a.createElement("input",{type:"text",value:this.state.SearchQuery,onChange:this.handleSearchChanged,onBlur:this.handleSearchBlur,onKeyDown:this.handleKeyDown,readOnly:this.state.Submitted,ref:function(e){return t.inputElement=e}}),e)}}]),t}(a.Component),v=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(l.a)(this,Object(c.a)(t).call(this,e))).handleRidersChanged=n.handleRidersChanged.bind(Object(o.a)(Object(o.a)(n))),n.handleAddLocationClicked=n.handleAddLocationClicked.bind(Object(o.a)(Object(o.a)(n))),n.handleSearchResultChanged=n.handleSearchResultChanged.bind(Object(o.a)(Object(o.a)(n))),n.state={NumRiders:e.NumRiders,SearchResult:e.SearchResult,SubmitEnabled:!1,Submitted:!1},n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"handleRidersChanged",value:function(e){this.setState({NumRiders:e.target.value},this.resetSubmitEnabled)}},{key:"handleSearchResultChanged",value:function(e){console.log("handleSearchResultsChanged "),this.setState({SearchResult:e.SearchResult},this.resetSubmitEnabled)}},{key:"handleAddLocationClicked",value:function(){this.props.submitLocationRider(this.state)}},{key:"resetSubmitEnabled",value:function(){this.state.NumRiders&&this.state.SearchResult&&this.setState({SubmitEnabled:!0})}},{key:"render",value:function(){return a.createElement("table",null,a.createElement("td",null),a.createElement("td",null),a.createElement("tr",null,a.createElement(p,{SearchResult:{SearchQuery:"",SearchResult:this.state.SearchResult},searchResultsChanged:this.handleSearchResultChanged}),a.createElement("div",{style:{display:"inline-block"}},a.createElement("label",{className:"RidersLabel"},"# Riders"),a.createElement("input",{className:"Riders",value:this.state.NumRiders,onChange:this.handleRidersChanged}),a.createElement("button",{className:"AddLocation",onClick:this.handleAddLocationClicked,disabled:!this.state.SubmitEnabled},"Add location"))))}}]),t}(a.Component),f=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(l.a)(this,Object(c.a)(t).call(this,e))).state={LocationRiders:new Array},n.handleLocationRiderChanged=n.handleLocationRiderChanged.bind(Object(o.a)(Object(o.a)(n))),n.handleSubmitRider=n.handleSubmitRider.bind(Object(o.a)(Object(o.a)(n))),n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"handleLocationRiderChanged",value:function(e){}},{key:"handleSubmitRider",value:function(e){var t=this,n=this.state.LocationRiders;n.push(e),this.setState({LocationRiders:n},function(){return t.props.handleLocationRidersChanged(t.state.LocationRiders)})}},{key:"render",value:function(){var e=this,t=[a.createElement(v,{submitLocationRider:function(t){return e.handleSubmitRider(t)},handleLocationRiderChanged:this.handleLocationRiderChanged})],n=!0,i=!1,r=void 0;try{for(var s,l=this.state.LocationRiders[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var c=s.value;t.push(a.createElement(v,{NumRiders:c.NumRiders,SearchResult:c.SearchResult,submitLocationRider:function(t){return e.handleSubmitRider(t)}}))}}catch(u){i=!0,r=u}finally{try{n||null==l.return||l.return()}finally{if(i)throw r}}return a.createElement("ol",null,t)}}]),t}(a.Component),R=n(212),g=n(43),E=n.n(g),j=function(e){function t(){return Object(r.a)(this,t),Object(l.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=g.from(this.props.instructions.instructions).skip(2).toArray().map(function(e){var t,n,i;return e.itineraryItem&&("Location:("+e.itineraryItem.location.latitude+", "+e.itineraryItem.location.longitude+")",e.itineraryItem.name&&(t=a.createElement("span",null,a.createElement("b",null,"Place:"),a.createElement("label",null,e.itineraryItem.name)))),e.endTime&&(n=a.createElement("span",null,a.createElement("b",null,"EndTime:")," ",e.endTime)),e.duration&&(i=a.createElement("span",null," ",a.createElement("b",null,"Duration:"),e.duration)),a.createElement("li",{key:e.startTime+e.instructionType},a.createElement("b",null,"Start:"),e.startTime," ",t,a.createElement("br",null),a.createElement("b",null," Type:"),e.instructionType," ",n," ",i)});return a.createElement("div",null,"Total time:",this.props.instructions.durationMinutes," minutes",a.createElement("ol",null,e))}}]),t}(a.Component),O=n(208),C=n.n(O),T=function(e){function t(e){var n;Object(r.a)(this,t);return(n=Object(l.a)(this,Object(c.a)(t).call(this,e))).state=Object(R.a)({},{collapsed:!0},n.calculateState(),{startingPoint:n.props.instructionSet.instructions[2].itineraryItem.name}),n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"calculateState",value:function(){return{totalHours:Math.floor(this.props.instructionSet.durationMinutes/60),totalMinutes:this.props.instructionSet.durationMinutes%60,totalDistance:this.props.instructionSet.distance}}},{key:"componentDidUpdate",value:function(){var e=this.calculateState();this.state.totalDistance==e.totalDistance&&this.state.totalHours==e.totalHours&&this.state.totalMinutes==e.totalMinutes||this.setState(e)}},{key:"render",value:function(){var e="Total Time:".concat(this.state.totalHours," hrs ").concat(this.state.totalMinutes.toFixed()," min Total Distance:").concat(this.props.instructionSet.distance.toFixed(1)," mi Starting Point:").concat(this.props.instructionSet.instructions[2].itineraryItem.name);return a.createElement(C.a,{trigger:e},a.createElement(j,{instructions:this.props.instructionSet}))}}]),t}(a.Component),L=n(209),k=n(122),w=n.n(k),I=n(210),D=n.n(I),A=function e(t,n,a,i,s,l){Object(r.a)(this,e),this.name=t,this.dwellTime=n,this.location=a,this.openingTime=i,this.closingTime=s,this.startingTime=l},Q=function(){function e(t){Object(r.a)(this,e),this.agent=void 0,this.instructions=void 0,this.distance=void 0,this.durationMinutes=void 0,this.instructions=t.instructions,this.agent=t.agent,this.distance=this.calcdistance(),this.durationMinutes=this.calcMinutes()}return Object(s.a)(e,[{key:"calcdistance",value:function(){for(var e=0,t=0;t<this.instructions.length;t++)this.instructions[t].distance&&(e+=this.instructions[t].distance);return 621371e-9*e}},{key:"calcMinutes",value:function(){return new D.a(new Date(this.instructions[this.instructions.length-1].startTime),new Date(this.instructions[0].startTime)).minutes()}},{key:"startingPoint",get:function(){return this.instructions[2].itineraryItem.name}}]),e}(),M=function(){function e(t){Object(r.a)(this,e),this.resourceSets=t}return Object(s.a)(e,[{key:"instructionSets",get:function(){return this.resourceSets[0].resources[0].agentItineraries.map(function(e){return new Q(e)})}}]),e}(),x=function e(t,n){Object(r.a)(this,e),this.agents=t,this.itineraryItems=n},N=function(){function e(){Object(r.a)(this,e)}return Object(s.a)(e,[{key:"getItinerary",value:function(){var e=Object(m.a)(d.a.mark(function e(t){var n,a,i,r;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.searchParams.map(function(e){return new A(e.SearchResult,"00:"+t.dwellTime+":00",{latitude:e.Coords.Lat,longitude:e.Coords.Long})}),a=void 0==t.startTime?"2019-11-16T08:00:00":w()(t.startTime,"yyyy-mm-ddThh:MM:ss"),i=void 0==t.endTime?"2019-11-16T18:00:00":w()(t.endTime,"yyyy-mm-ddThh:MM:ss"),a=a.replace("P","T").replace("A","T"),i=i.replace("P","T").replace("A","T"),e.next=7,L.post("https://dev.virtualearth.net/REST/V1/Routes/OptimizeItinerary?key=ArLJodQ7fEaQ2dfy3lIHWJrJILC35_Qj0EpT8TCy3ls96pl6sqCdlu18bo8j_tbM",{resolveWithFullResponse:!1,json:new x([{name:"Kayode",shifts:[{startTime:a,endTime:i,endLocation:{latitude:t.endLocation.Lat,longitude:t.endLocation.Long},startLocation:{latitude:t.startLocation.Lat,longitude:t.startLocation.Long}}]}],n)});case 7:return r=e.sent,e.abrupt("return",new M(r.resourceSets));case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),H=function(){function e(t){Object(r.a)(this,e),this.itinerary=t}return Object(s.a)(e,[{key:"getItineraries",value:function(){var e=Object(m.a)(d.a.mark(function e(t){var n,a,i,r,s,l,c,u;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=new Array,a=!0,i=!1,r=void 0,e.prev=4,s=t.searchResults[Symbol.iterator]();case 6:if(a=(l=s.next()).done){e.next=17;break}return c=l.value,new Date(2019,11,17,10,0),new Date(2019,11,18,22,0),e.next=12,this.itinerary.getItinerary({startLocation:c.Coords,searchParams:t.searchResults,dwellTime:t.dwellTime,endLocation:t.endLocation,startTime:c.StartTime,endTime:c.EndTime});case 12:u=e.sent,n.push(u);case 14:a=!0,e.next=6;break;case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(4),i=!0,r=e.t0;case 23:e.prev=23,e.prev=24,a||null==s.return||s.return();case 26:if(e.prev=26,!i){e.next=29;break}throw r;case 29:return e.finish(26);case 30:return e.finish(23);case 31:return e.abrupt("return",{itineraries:g.from(n).orderBy(function(e){return g.from(e.instructionSets).max(function(e){return e.durationMinutes})}).select(function(e){return e}).toArray()});case 32:case"end":return e.stop()}},e,this,[[4,19,23,31],[24,,26,30]])}));return function(t){return e.apply(this,arguments)}}()}]),e}(),J=n(211),P=n.n(J),q=n(27),B=function(e){function t(e){var n;Object(r.a)(this,t),n=Object(l.a)(this,Object(c.a)(t).call(this,e));var a=q.b(new Date,"day"),i=q.a(a,20,"hours"),s=q.a(i,-1,"day");return n.state={Arrivaltime:q.a(s,1,"minutes")},n.handleArrivalTimeChanged=n.handleArrivalTimeChanged.bind(Object(o.a)(Object(o.a)(n))),n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"handleArrivalTimeChanged",value:function(e){this.setState({Arrivaltime:e})}},{key:"render",value:function(){if(!this.props.ItinerariesResponse)return a.createElement("div",null);var e,t=this.props.ItinerariesResponse.itineraries.map(function(e){return a.createElement("li",null,a.createElement(T,{instructionSet:e.instructionSets[0]}))});return e=a.createElement("ol",null,t),a.createElement("div",null,a.createElement("h1",null,"Itineraries:"),a.createElement("ol",null,e))}}]),t}(a.Component),F=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(l.a)(this,Object(c.a)(t).call(this,e))).itineraryCollection=void 0,n.itinerary=void 0,n.searchResultHashmap={},n.itinerary=new N,n.itineraryCollection=new H(n.itinerary),n.handleDestinationChanged=n.handleDestinationChanged.bind(Object(o.a)(Object(o.a)(n))),n.state={DwellTime:15,Arrivaltime:n.initializeArrivalTime()},n.handleDwellTimeChanged=n.handleDwellTimeChanged.bind(Object(o.a)(Object(o.a)(n))),n.handleMultipleItinerarySearch=n.handleMultipleItinerarySearch.bind(Object(o.a)(Object(o.a)(n))),n.handleSearchItineraries=n.handleSearchItineraries.bind(Object(o.a)(Object(o.a)(n))),n.handleReadjustForArrival=n.handleReadjustForArrival.bind(Object(o.a)(Object(o.a)(n))),n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"initializeArrivalTime",value:function(){var e=q.b(new Date,"day"),t=q.a(e,20,"hours"),n=q.a(t,-1,"day");return q.a(n,1,"minutes")}},{key:"render",value:function(){var e=this;if(this.state&&this.state.ItineraryResponse&&this.state.ItineraryResponse.resourceSets)a.createElement(T,{instructionSet:this.state.ItineraryResponse.instructionSets[0]});else if(this.state&&this.state.ItinerariesResponse){var t=this.state.ItinerariesResponse.itineraries.map(function(e){return a.createElement("li",null,a.createElement(T,{instructionSet:e.instructionSets[0]}))});a.createElement("ol",null,t)}return a.createElement("div",null,a.createElement("div",null,"Enter destination:",a.createElement("div",null,a.createElement(p,{SearchResult:{SearchQuery:"",SearchResult:void 0},searchResultsChanged:this.handleDestinationChanged}))),a.createElement("div",null,"Enter dwell time:",a.createElement("br",null),a.createElement("input",{value:this.state.DwellTime,onChange:this.handleDwellTimeChanged})),"Enter arrival time:",a.createElement("br",null),a.createElement(P.a,{value:this.state.Arrivaltime,onChange:this.handleArrivalTimeChanged}),a.createElement(f,{handleLocationRidersChanged:function(t){return e.handleLocationRidersChanged(t)}}),a.createElement("button",{onClick:this.handleSearchItineraries},"Search"),a.createElement(B,{ItinerariesResponse:this.state.ItinerariesResponse}))}},{key:"handleLocationRidersChanged",value:function(e){E.a.from(e).select(function(e){return new y(e.SearchResult,e.NumRiders)})}},{key:"handleArrivalTimeChanged",value:function(e){this.setState({Arrivaltime:e})}},{key:"handleReadjustForArrival",value:function(e){var t=this;this.state.SearchResults.forEach(function(n){var a=t.searchResultHashmap[n.SearchResult];a+=2;var i=q.a(e,-a,"minutes");n.StartTime=i,n.EndTime=q.a(i,1,"day")}),this.handleSearchItineraries()}},{key:"handleMultipleItinerarySearch",value:function(e){this.setState({SearchResults:e})}},{key:"handleSearchItineraries",value:function(){var e=this;this.itineraryCollection.getItineraries({dwellTime:this.state.DwellTime,searchResults:this.state.SearchResults,endLocation:this.state.Destination.Coords}).then(function(t){e.setState({ItinerariesResponse:t}),t.itineraries.forEach(function(t){t.instructionSets.forEach(function(t){e.searchResultHashmap[t.startingPoint]=t.durationMinutes})})}).then(function(){e.handleReadjustForArrival(e.state.Arrivaltime)})}},{key:"handleDestinationChanged",value:function(e){console.log("handle destination changed:"+JSON.stringify(e)),this.setState({Destination:e})}},{key:"handleDwellTimeChanged",value:function(e){this.setState({DwellTime:e.target.value})}}]),t}(a.Component);var K=document.getElementById("root");Object(i.render)(a.createElement(function(){return a.createElement("div",{className:"App"},a.createElement("h1",null,"Hello CodeSandbox Test"),a.createElement("h2",null,"Enter locations"),a.createElement(F,null))},null),K)}},[[213,2,1]]]);
//# sourceMappingURL=main.91d4af55.chunk.js.map